# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge

on:
  push:
    branches:
      - main
    paths:
      # srcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚ŒãŸæ™‚
      - 'src/**'
      # package.jsonãŒæ›´æ–°ã•ã‚ŒãŸæ™‚
      - 'package.json'

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci && npm run build
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_BAR_APP_1BC1B }}
          channelId: live
          projectId: bar-app-1bc1b
        continue-on-error: true # ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚æ¬¡ã«é€²ã‚€

  notify:
    runs-on: ubuntu-latest
    needs: build_and_deploy
    steps:
      - name: Determine message
        id: message
        run: |
          if [[ "${{ needs.build_and_deploy.outputs.result }}" == "success" ]]; then
            echo "title=æˆåŠŸï¼" >> $GITHUB_ENV
            echo "description=ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã—ã¾ã—ãŸï¼ ðŸŽ‰" >> $GITHUB_ENV
            echo "color=3066993" >> $GITHUB_ENV # ç·‘è‰²
          else
            echo "title=å¤±æ•—ï¼" >> $GITHUB_ENV
            echo "description=ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ âŒ" >> $GITHUB_ENV
            echo "color=15158332" >> $GITHUB_ENV # èµ¤è‰²
          fi

      - name: Send embed message to Discord
        uses: Ilshidur/action-discord@v1.0.0
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          embeds: |
            [
              {
                "title": "${{ env.title }}",
                "description": "${{ env.description }}",
                "color": ${ env.color }
              }
            ]
